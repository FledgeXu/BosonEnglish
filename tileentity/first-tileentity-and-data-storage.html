<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>First TileEntity and Data Storage - Boson 1.16 Modding Tutorail</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introducation/intro.html"><strong aria-hidden="true">1.</strong> Introducation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../introducation/what-is-forge.html"><strong aria-hidden="true">1.1.</strong> What is Forge?</a></li><li class="chapter-item expanded "><a href="../introducation/how-minecraft-works.html"><strong aria-hidden="true">1.2.</strong> How Minecraft Works?</a></li><li class="chapter-item expanded "><a href="../introducation/development-model.html"><strong aria-hidden="true">1.3.</strong> Development Model</a></li><li class="chapter-item expanded "><a href="../introducation/core-conception.html"><strong aria-hidden="true">1.4.</strong> Core Concepetion</a></li></ol></li><li class="chapter-item expanded "><a href="../devenvironment/intro.html"><strong aria-hidden="true">2.</strong> Development Environment</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../devenvironment/setup-environment.html"><strong aria-hidden="true">2.1.</strong> Setup Environment</a></li><li class="chapter-item expanded "><a href="../devenvironment/introduce-environment.html"><strong aria-hidden="true">2.2.</strong> Introduce Environment</a></li><li class="chapter-item expanded "><a href="../devenvironment/customize-mod-info.html"><strong aria-hidden="true">2.3.</strong> Customize Mod Info</a></li></ol></li><li class="chapter-item expanded "><a href="../item/intro.html"><strong aria-hidden="true">3.</strong> Item</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../item/first-item.html"><strong aria-hidden="true">3.1.</strong> First Item</a></li><li class="chapter-item expanded "><a href="../item/model-and-texture.html"><strong aria-hidden="true">3.2.</strong> Model and Texture</a></li><li class="chapter-item expanded "><a href="../item/item-and-itemstack.html"><strong aria-hidden="true">3.3.</strong> Item and ItemStack</a></li><li class="chapter-item expanded "><a href="../item/item-group.html"><strong aria-hidden="true">3.4.</strong> Item Group</a></li><li class="chapter-item expanded "><a href="../item/food.html"><strong aria-hidden="true">3.5.</strong> Food</a></li><li class="chapter-item expanded "><a href="../item/sword.html"><strong aria-hidden="true">3.6.</strong> Sword</a></li><li class="chapter-item expanded "><a href="../item/tool.html"><strong aria-hidden="true">3.7.</strong> Tool</a></li><li class="chapter-item expanded "><a href="../item/armor.html"><strong aria-hidden="true">3.8.</strong> Armor</a></li><li class="chapter-item expanded "><a href="../item/item-property-override.html"><strong aria-hidden="true">3.9.</strong> Item Property Override</a></li></ol></li><li class="chapter-item expanded "><a href="../localization/localization.html"><strong aria-hidden="true">4.</strong> Localization</a></li><li class="chapter-item expanded "><a href="../block/intro.html"><strong aria-hidden="true">5.</strong> Block</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../block/first-block.html"><strong aria-hidden="true">5.1.</strong> First Block</a></li><li class="chapter-item expanded "><a href="../block/block-and-blocksstate.html"><strong aria-hidden="true">5.2.</strong> Block and BlockState</a></li><li class="chapter-item expanded "><a href="../block/block-model-and-texture.html"><strong aria-hidden="true">5.3.</strong> Block's Model and Texture</a></li><li class="chapter-item expanded "><a href="../block/block-with-blocksstate.html"><strong aria-hidden="true">5.4.</strong> Block with BlockState</a></li><li class="chapter-item expanded "><a href="../block/not-solid-block-and-custom-model.html"><strong aria-hidden="true">5.5.</strong> Not Solid Block and custom model</a></li><li class="chapter-item expanded "><a href="../block/rendertype.html"><strong aria-hidden="true">5.6.</strong> Render Type</a></li></ol></li><li class="chapter-item expanded "><a href="../specialmodel/intro.html"><strong aria-hidden="true">6.</strong> Special Model</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../specialmodel/obj-model.html"><strong aria-hidden="true">6.1.</strong> Obj Model</a></li></ol></li><li class="chapter-item expanded "><a href="../tileentity/intro.html"><strong aria-hidden="true">7.</strong> TileEntity</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tileentity/first-tileentity-and-data-storage.html" class="active"><strong aria-hidden="true">7.1.</strong> First TileEntity and Data Storage</a></li><li class="chapter-item expanded "><a href="../tileentity/itickabletileentity.html"><strong aria-hidden="true">7.2.</strong> ITickableTileEntity</a></li><li class="chapter-item expanded "><a href="../tileentity/tileentity-data-sync.html"><strong aria-hidden="true">7.3.</strong> TileEntity's Data Sync</a></li></ol></li><li class="chapter-item expanded "><a href="../specialrender/intro.html"><strong aria-hidden="true">8.</strong> Special render</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../specialrender/ibakedmodel.html"><strong aria-hidden="true">8.1.</strong> IBakedModel</a></li><li class="chapter-item expanded "><a href="../specialrender/ter.html"><strong aria-hidden="true">8.2.</strong> TileEntityRneder</a></li><li class="chapter-item expanded "><a href="../specialrender/ister.html"><strong aria-hidden="true">8.3.</strong> ItemStackTileEntityRenderer</a></li></ol></li><li class="chapter-item expanded "><a href="../event/intro.html"><strong aria-hidden="true">9.</strong> Event System</a></li><li class="chapter-item expanded "><a href="../networking/intro.html"><strong aria-hidden="true">10.</strong> Network</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../networking/network-packet.html"><strong aria-hidden="true">10.1.</strong> Network Packet</a></li><li class="chapter-item expanded "><a href="../networking/network-security.html"><strong aria-hidden="true">10.2.</strong> Network Security</a></li></ol></li><li class="chapter-item expanded "><a href="../entity/intro.html"><strong aria-hidden="true">11.</strong> Entity</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../entity/first-entity.html"><strong aria-hidden="true">11.1.</strong> First Entity and Data Sync</a></li><li class="chapter-item expanded "><a href="../entity/animal-and-ai.html"><strong aria-hidden="true">11.2.</strong> Animal and AI</a></li></ol></li><li class="chapter-item expanded "><a href="../capability/intro.html"><strong aria-hidden="true">12.</strong> Capability System</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../capability/capability-from-scratch.html"><strong aria-hidden="true">12.1.</strong> Capability from Scratch</a></li><li class="chapter-item expanded "><a href="../capability/use-predefined-capability.html"><strong aria-hidden="true">12.2.</strong> Use Predefined Capability</a></li><li class="chapter-item expanded "><a href="../capability/attach-capability-provider.html"><strong aria-hidden="true">12.3.</strong> Attach Capability provider</a></li></ol></li><li class="chapter-item expanded "><a href="../worldsaveddata/worldsaveddata.html"><strong aria-hidden="true">13.</strong> WorldSavedData</a></li><li class="chapter-item expanded "><a href="../gui/intro.html"><strong aria-hidden="true">14.</strong> Gui</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../gui/first-gui.html"><strong aria-hidden="true">14.1.</strong> First Gui</a></li><li class="chapter-item expanded "><a href="../gui/container.html"><strong aria-hidden="true">14.2.</strong> Container</a></li><li class="chapter-item expanded "><a href="../gui/hud.html"><strong aria-hidden="true">14.3.</strong> HUD</a></li></ol></li><li class="chapter-item expanded "><a href="../fluid/first-fluid.html"><strong aria-hidden="true">15.</strong> Fluid</a></li><li class="chapter-item expanded "><a href="../worldgeneration/intro.html"><strong aria-hidden="true">16.</strong> World Generation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../worldgeneration/ore-generation.html"><strong aria-hidden="true">16.1.</strong> Ore Generation</a></li><li class="chapter-item expanded "><a href="../worldgeneration/structure-generation.html"><strong aria-hidden="true">16.2.</strong> Structure Generation</a></li><li class="chapter-item expanded "><a href="../worldgeneration/customize-biome-and-world-type.html"><strong aria-hidden="true">16.3.</strong> Customize Biome and World Type</a></li><li class="chapter-item expanded "><a href="../worldgeneration/customize-dimension.html"><strong aria-hidden="true">16.4.</strong> Customize Dimension</a></li></ol></li><li class="chapter-item expanded "><a href="../datapack/intro.html"><strong aria-hidden="true">17.</strong> Data Pack</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../datapack/recipes.html"><strong aria-hidden="true">17.1.</strong> Recipe</a></li><li class="chapter-item expanded "><a href="../datapack/lootable.html"><strong aria-hidden="true">17.2.</strong> LootTable</a></li></ol></li><li class="chapter-item expanded "><a href="../datagnerator/intro.html"><strong aria-hidden="true">18.</strong> Data Generator</a></li><li class="chapter-item expanded "><a href="../command/command.html"><strong aria-hidden="true">19.</strong> Command</a></li><li class="chapter-item expanded "><a href="../advancements/intro.html"><strong aria-hidden="true">20.</strong> Advancements</a></li><li class="chapter-item expanded "><a href="../configure/configure.html"><strong aria-hidden="true">21.</strong> Configure</a></li><li class="chapter-item expanded "><a href="../potion/intro.html"><strong aria-hidden="true">22.</strong> Potion</a></li><li class="chapter-item expanded "><a href="../paticles/intro.html"><strong aria-hidden="true">23.</strong> Paticle</a></li><li class="chapter-item expanded "><a href="../sounds/intro.html"><strong aria-hidden="true">24.</strong> Sound</a></li><li class="chapter-item expanded "><a href="../io/intro.html"><strong aria-hidden="true">25.</strong> User Input</a></li><li class="chapter-item expanded "><a href="../compatible/intro.html"><strong aria-hidden="true">26.</strong> Compatibiilty</a></li><li class="chapter-item expanded "><a href="../at/intro.html"><strong aria-hidden="true">27.</strong> Access Transformer</a></li><li class="chapter-item expanded "><a href="../coremode/intro.html"><strong aria-hidden="true">28.</strong> CoreMod</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Boson 1.16 Modding Tutorail</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#first-tileentity-and-data-storage" id="first-tileentity-and-data-storage">First TileEntity and Data Storage</a></h1>
<p>In this section, we will learn how to create a block entity of our own. Let’s take a counter as an example. Its only function is to increase by one when you right-click the block, and then send the corresponding one to your chat box value.</p>
<p>First, let's create our Block <code>ObsidianCounter.java</code>:</p>
<pre><code class="language-java">public class ObsidianCounter extends Block {
    public ObsidianCounter() {
        super(Properties.create(Material.ROCK).hardnessAndResistance(5));
    }

    @Override
    public boolean hasTileEntity(BlockState state) {
        return true;
    }

    @Nullable
    @Override
    public TileEntity createTileEntity(BlockState state, IBlockReader world) {
        return new ObsidianCounterTileEntity();
    }

    @Override
    public ActionResultType onBlockActivated(BlockState state, World worldIn, BlockPos pos, PlayerEntity player, Hand handIn, BlockRayTraceResult hit) {
        if (!worldIn.isRemote &amp;&amp; handIn == Hand.MAIN_HAND) {
            ObsidianCounterTileEntity obsidianCounterTileEntity = (ObsidianCounterTileEntity) worldIn.getTileEntity(pos);
            int counter = obsidianCounterTileEntity.increase();
            TranslationTextComponent translationTextComponent = new TranslationTextComponent(&quot;message.neutrino.counter&quot;, counter);
            player.sendStatusMessage(translationTextComponent, false);
        }
        return ActionResultType.SUCCESS;
    }
}
</code></pre>
<p>We won't go into details about the registration part, here we will talk about a few functions. The first thing to talk about is the set of functions <code>hasTileEntity</code> and <code>createTileEntity</code> (**Please note that the two methods here are not <code>@Deprecated</code>, that is, they are not &quot;crossed&quot; after you rewrite What we need to rewrite is the method under the ʻIForgeBlock<code>interface, please be careful not to rewrite the wrong method**), this set of functions allows your block to be bound to a block entity, and the return value of</code>hasTileEntity<code>is set to</code>true <code>, it means that our block has a block entity. The function </code>createTileEntity<code>determines which block entity our block is. In our case, it is</code>ObsidianCounterTileEntity`.</p>
<p>Let's skip the <code>onBlockActivated</code> method first to see what is in our block entity.</p>
<p><code>ObsidianCounterTileEntity</code>:</p>
<pre><code class="language-java">public class ObsidianCounterTileEntity extends TileEntity {
    private int counter = 0;

    public ObsidianCounterTileEntity() {
        super(TileEntityTypeRegistry.obsidianCounterTileEntity.get());
    }

    public int increase() {
        counter++;
        markDirty();
        return counter;
    }
}
</code></pre>
<p>As you can see, the content in this block entity is very simple, with only one construction method and one <code>increase</code> method. The <code>increase</code> method is related to the specific content we want to achieve. Here, let's first look at the construction method.</p>
<pre><code class="language-java">super(TileEntityTypeRegistry.obsidianCounterTileEntity.get());
</code></pre>
<p>In the construction method here, we passed a <code>TilEnttityType</code> to our parent class, so what is this <code>TilEntityType</code>? This <code>TileEntityType</code> hence the name implies the &quot;type&quot; of the block entity. This &quot;type&quot; specifies how our block entity should be created and which blocks it is bound to. Next we will take a look at our <code>TilEntityType </code>How was it created and registered?</p>
<p>Then we created a new class called <code>TileEntityTypeRegistry</code>:</p>
<pre><code class="language-java">public class TileEntityTypeRegistry {
    public static final DeferredRegister&lt;TileEntityType&lt;?&gt;&gt; TILE_ENTITIES = DeferredRegister.create(ForgeRegistries.TILE_ENTITIES, Utils.MOD_ID);
    public static final RegistryObject&lt;TileEntityType&lt;ObsidianCounterTileEntity&gt;&gt; obsidianCounterTileEntity = TILE_ENTITIES.register(&quot;obsidian_counter_tileentity&quot;, () -&gt; TileEntityType.Builder.create(ObsidianCounterTileEntity::new, BlockRegistry.obsidianCounterBlock.get()).build(null));
}
</code></pre>
<p>The first is the type, because <code>TileEntityType</code> is a generic class, and its generics can contain various <code>TileEntity</code>, so when we define <code>TILE_ENTITIES</code>, the type in <code>DeferredRegister</code> is <code>TileEntityType&lt;?&gt;</code>, the question mark here means that various <code>TileEntityType</code> such as <code>TileEntityType&lt;AEntity&gt;</code> and <code>TileEntityType&lt;BEntity&gt;</code> can be registered in <code>TILE_ENTITIES</code>.</p>
<p>Then the type of our variable, because we are going to register <code>TileEntityType</code> for <code>ObsidianCounterTileEntity</code>, so the type we need is naturally <code>TileEntityType&lt;ObsidianCounterTileEntity&gt;</code>.</p>
<p>The most complicated thing here should be the specific registration process, but it is not difficult to understand. The same as before, it is the registered name and a registered object. We can split this complicated sentence apart.</p>
<pre><code class="language-java">TILE_ENTITY_TYPE_DEFERRED_REGISTER.register(&quot;obsidian_counter_tileentity&quot;,()-&gt; ...);
</code></pre>
<p>If we omit a series of complicated content inside, the core of this code is such a sentence, I believe everyone can understand this, the key point here is the &quot;...&quot; we omitted.</p>
<p>The previously omitted content is as follows:</p>
<pre><code class="language-java">TileEntityType.Builder.create(ObsidianCounterTileEntity::new, BlockRegistry.obsidianCounterBlock.get()).build(null));
</code></pre>
<p>As you can see, here we first call the <code>TileEntityType.Builder.create</code> method, which is a method provided by Minecraft to create a <code>TileEntityType</code>, and then call the <code>build</code> method. Let's first look at the parameters in the <code>build</code> method. In <code>build</code> we passed in a <code>null</code>. In fact, this place can be filled with an instance called <code>datafix</code>, which is used to archive different versions before Converted. Here we do not have this requirement (most mods are not expected to be realized), so we fill in a <code>null</code>.</p>
<p>Then we look back at the two parameters in <code>TileEntityType.Builder.create</code>, the first parameter is a <code>supplier</code>, here we fill in the method reference of the construction method of the block entity, and the second type is and For the associated block, here we fill in the instance of our registered <code>ObsidianCounterBlock</code>. As for the registration of the block, I believe that the readers here have the ability to solve it by themselves.</p>
<p>This way the content is a lot less at once, but for the convenience of readers' understanding, I still use the above writing method. Of course, don't forget to register <code>TILE_ENTITIES</code> in the Mod bus in your Mod main class.</p>
<p>Then we can take a look at our logic</p>
<pre><code class="language-java">@Override
public ActionResultType onBlockActivated(BlockState state, World worldIn, BlockPos pos, PlayerEntity player, Hand handIn, BlockRayTraceResult hit) {
  if (!worldIn.isRemote &amp;&amp; handIn == Hand.MAIN_HAND) {
    ObsidianCounterTileEntity obsidianCounterTileEntity = (ObsidianCounterTileEntity) worldIn.getTileEntity(pos);
    int counter = obsidianCounterTileEntity.increase();
    TranslationTextComponent translationTextComponent = new TranslationTextComponent(&quot;message.neutrino.counter&quot;, counter);
    player.sendStatusMessage(translationTextComponent, false);
  }
  return ActionResultType.SUCCESS;
}
</code></pre>
<p>The first is the block's <code>onBlockActivated</code> method. Please note that there are two <code>onBlockActivated</code> methods with the same name but different return values. Don't rewrite the method wrong.</p>
<pre><code class="language-java">if (!worldIn.isRemote &amp;&amp; handIn == Hand.MAIN_HAND)
</code></pre>
<p>First of all, we judged whether our method is called on the server side. Remember that any logic that involves data processing should be executed on the server side. In addition, we also judged whether the incoming <code>handIn</code> is the &quot;master hand&quot;. This judgment is made because this method will be executed once for both hands.</p>
<pre><code class="language-java">ObsidianCounterTileEntity obsidianCounterTileEntity = (ObsidianCounterTileEntity) worldIn.getTileEntity(pos);
</code></pre>
<p>Here we call the <code>worldIn.getTileEntity</code> method to get the <code>TileEntity</code> corresponding to our block. The reason must be called by this method is that even if a block is bound to a TileEntity, you cannot guarantee that this <code>TileEntity</code> It must exist.</p>
<pre><code class="language-java">int counter = obsidianCounterTileEntity.increase();
</code></pre>
<p>Then we here increase and get the value by calling the <code>increase</code> method of our <code>obsidianCounterTileEntity</code>.</p>
<pre><code class="language-java">public int increase() {
  counter++;
  return counter;
}
</code></pre>
<p>The content of the <code>increase</code> method is very simple, I believe everyone can understand it.</p>
<pre><code class="language-java">TranslationTextComponent translationTextComponent = new TranslationTextComponent(&quot;message.neutrino.counter&quot;, counter);
</code></pre>
<p>Then there is this sentence, first we create a <code>TranslationTextComponent</code>, here is the content we want to send to the player's chat box. As its name implies, this is a translated text, so it should be a &quot;key&quot; rather than a specific content, <code>&quot;message.tour14.counter&quot;</code> is the &quot;key&quot; value, we also passed in later The count value obtained, the reason for this, we first press the table.</p>
<p>First, we add the following content to the language file (take English as an example).</p>
<pre><code class="language-json"> &quot;message.neutrino.counter&quot;: &quot;count: %d&quot;
</code></pre>
<p>You can see that there is a <code>%d</code> here. At this time, the reason why we need to pass in our value is very clear. In fact, the value of our <code>counter</code> variable is formatted through <code>%d</code> .</p>
<pre><code class="language-java">player.sendStatusMessage(translationTextComponent, false);
</code></pre>
<p>Finally, we call this statement and send a message to the player. Please note that because we have judged <code>!worldIn.isRemote</code> before, although this code is executed on the server side, because the specific message is displayed on the client side , So we need to send a message to the client by sending a package. Fortunately, Minecraft provides us with this method to send data, so we don’t need to implement it ourselves.</p>
<p><img src="first-tileentity-and-data-storage.assets/image-20200429165945640.png" alt="image-20200429165945640" /></p>
<p>You can see that our block can be successfully counted.</p>
<p>But there is a bug in this block. When you exit the current save and re-enter, you will find that our counter starts counting from 0 again. Next, let's fix this problem.</p>
<p>The reason for this bug is that when the save is running, the value of the counter exists in the memory and can function normally, but when the game is closed, because the important data in the memory is not saved to your hard disk, so open it next time During the game, these data cannot be reloaded and restored. Before our TileEntity did not implement this save and restore function, we will add this function to it next.</p>
<p>The content of the <code>ObsidianCounterTileEntity</code> after the addition is as follows:</p>
<pre><code class="language-java">public class ObsidianCounterTileEntity extends TileEntity {
    private int counter = 0;

    public ObsidianCounterTileEntity() {
        super(TileEntityTypeRegistry.obsidianCounterTileEntity.get());
    }

    public int increase() {
        counter++;
        markDirty();
        return counter;
    }

    @Override
    public void read(BlockState state, CompoundNBT nbt) {
        counter = nbt.getInt(&quot;counter&quot;);
        super.read(state, nbt);
    }

    @Override
    public CompoundNBT write(CompoundNBT compound) {
        compound.putInt(&quot;counter&quot;, counter);
        return super.write(compound);
    }
}
</code></pre>
<p>As you can see, compared to the previous code, we have overwritten the <code>write</code> and <code>read</code> methods. These two methods are used to save and restore data. In Minecraft, all data should ultimately be saved in NBT format (unless you implement the save method yourself), and the NBT tag in the code is represented by <code>CompoundNBT</code>. NBT tags are also a &quot;key-value pair&quot; structure, and each value has a corresponding name. The method at the beginning of <code>put</code> is to write a value to the NBT tag, and the method at the beginning of <code>get</code> is to get the value. In addition to <code>CompoudNBT</code>, there is also the <code>ListNBT</code> class to represent the NBT tag of the array type.</p>
<p>The <code>write</code> here is the method of data saving. Its incoming value is the NBT tag that has been saved by other classes before, and its return value is the NBT tag that will eventually be saved to the hard disk (there are other classes to write Enter), under normal circumstances, you should call <code>return super.write(compound);</code> to do the final return.</p>
<p>The <code>read</code> method is just the opposite, here we call the <code>counter = compound.getInt(&quot;counter&quot;);</code> method to restore the data of our counter. Similarly, you should call <code>super.read(compound);</code> to do the final return.</p>
<p>Another very important thing is</p>
<pre><code class="language-java">public int increase() {
  counter++;
  markDirty();
  return counter;
}
</code></pre>
<p>We have added the <code>markDirty()</code> method here. This method means to mark our data as modified so that the game knows to save and call the save method when it is closed. This is because compared to the execution speed of the CPU, the saving and reading and writing speed of the hard disk is very slow, so if frequent saving and reading and writing operations will seriously slow down the speed of the game, a reasonable way is to mark that we need to save The data is then saved together at a unified point in time, the role of <code>markDirty()</code> is exactly this.</p>
<p><a href="https://github.com/FledgeXu/BosonSourceCode/tree/master/src/main/java/com/tutorial/boson/first_tileentity">Source Code</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../tileentity/intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../tileentity/itickabletileentity.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../tileentity/intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../tileentity/itickabletileentity.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        
        <!-- Google Analytics Tag -->
        <script type="text/javascript">
            var localAddrs = ["localhost", "127.0.0.1", ""];

            // make sure we don't activate google analytics if the developer is
            // inspecting the book locally...
            if (localAddrs.indexOf(document.location.hostname) === -1) {
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-80068655-4', 'auto');
                ga('send', 'pageview');
            }
        </script>
        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
